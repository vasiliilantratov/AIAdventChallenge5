# –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —á–∞—Ç —Å Ollama + MCP Weather Server

Kotlin-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å Ollama, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ–≥–æ–¥—ã. AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥–µ –≤ –ª—é–±–æ–º –≥–æ—Ä–æ–¥–µ –º–∏—Ä–∞ —á–µ—Ä–µ–∑ tool calling.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üí¨ –î–∏–∞–ª–æ–≥ —Å Ollama –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
- üå§Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MCP Weather Server - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
- üîß Tool calling - AI –º–æ–∂–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- üìä –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –≤ SQLite
- üìù –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ summary –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 21+
- Ollama —Å –º–æ–¥–µ–ª—å—é, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–π tool calling (–Ω–∞–ø—Ä–∏–º–µ—Ä, llama3.1:8b)
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `OLLAMA_BASE_URL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: http://localhost:11434)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- `OLLAMA_BASE_URL` ‚Äî –∞–¥—Ä–µ—Å Ollama API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:11434`)

## –ó–∞–ø—É—Å–∫

```bash
./gradlew run
```

–ü—Ä–∏ **–ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
1. –°–æ–∑–¥–∞—Å—Ç distribution –¥–ª—è MCP Weather Server (~5 —Å–µ–∫—É–Ω–¥)
2. –ó–∞–ø—É—Å—Ç–∏—Ç MCP Weather Server –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ Ollama
4. –ó–∞–≥—Ä—É–∑–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. –ë—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ –∫ –¥–∏–∞–ª–æ–≥—É —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã

–ü—Ä–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö** –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, —Ç–∞–∫ –∫–∞–∫ distribution —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:
```
Preparing weather server distribution...
[Weather Server] Weather MCP Server started
MCP server initialized successfully
‚úì MCP Weather Server –∑–∞–ø—É—â–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: [get_current_weather]
```

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

–°–º. [QUICKSTART.md](QUICKSTART.md) –∏–ª–∏ [WEATHER_MCP_README.md](WEATHER_MCP_README.md#troubleshooting)

## –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `llama3.1:8b` - –º–æ–¥–µ–ª—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è tool calling.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û–±—ã—á–Ω—ã–π –¥–∏–∞–ª–æ–≥
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –æ Kotlin.
/end

–ò–ò: [–æ—Ç–≤–µ—Ç –æ Kotlin]
```

### –ó–∞–ø—Ä–æ—Å—ã –æ –ø–æ–≥–æ–¥–µ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö–∞–∫–∞—è —Å–µ–π—á–∞—Å –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ?
/end

üîß –ò–ò –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
  - get_current_weather —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏: {"city":"Moscow"}
  ‚úì –†–µ–∑—É–ª—å—Ç–∞—Ç: [–¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ]

–ò–ò: –°–µ–π—á–∞—Å –≤ –ú–æ—Å–∫–≤–µ -5¬∞C, –æ–±–ª–∞—á–Ω–æ, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 80%...
```

–î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –æ –ø–æ–≥–æ–¥–µ:
- "–ö–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –õ–æ–Ω–¥–æ–Ω–µ?"
- "–†–∞—Å—Å–∫–∞–∂–∏ –æ –ø–æ–≥–æ–¥–µ –≤ –ù—å—é-–ô–æ—Ä–∫–µ"
- "–°—Ç–æ–∏—Ç –ª–∏ –±—Ä–∞—Ç—å –∑–æ–Ω—Ç –≤ –ü–∞—Ä–∏–∂–µ?"

## –ö–æ–º–∞–Ω–¥—ã –≤ —á–∞—Ç–µ

- `/exit` ‚Äî –≤—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã (–∑–∞–∫—Ä–æ–µ—Ç MCP —Å–µ—Ä–≤–µ—Ä)
- `/help` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- `/clear` ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏
- `/cleardb` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- `/model` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å
- `/stats` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–µ—Å—Å–∏–∏ (–∑–∞–ø—Ä–æ—Å—ã –∫ API, —Ç–æ–∫–µ–Ω—ã)
- `/end` ‚Äî –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤–≤–æ–¥ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ

## –í—ã–≤–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é ktoken):

- –¢–æ–∫–µ–Ω—ã –∑–∞ –∑–∞–ø—Ä–æ—Å: `prompt_tokens`, `completion_tokens`, `total_tokens`
- –°—É–º–º–∞—Ä–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é: `total_prompt_tokens`, `total_completion_tokens`, `total_tokens`

–ü—Ä–∏–º–µ—Ä:
```
–¢–æ–∫–µ–Ω—ã –∑–∞ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å (ktoken):
  prompt_tokens: 45
  completion_tokens: 120
  total_tokens: 165

–°—É–º–º–∞—Ä–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é:
  total_prompt_tokens: 230
  total_completion_tokens: 485
  total_tokens: 715
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `Main.kt` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π UI –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º
- `DomainModels.kt` ‚Äî –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (ChatMessage, OllamaChatRequest, Tool models)
- `OllamaChatClient.kt` ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Ollama
- `AiDialogService.kt` ‚Äî —Å–µ—Å—Å–∏—è —á–∞—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π tool calling –∏ –ø–æ–¥—Å—á—ë—Ç–æ–º —Ç–æ–∫–µ–Ω–æ–≤
- `MessageDatabase.kt` ‚Äî SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- `McpClientManager.kt` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å MCP —Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ JSON-RPC
- `ApiLogger.kt` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤

### Weather Server (MCP –º–æ–¥—É–ª—å)
- `weather-server/` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π Gradle –º–æ–¥—É–ª—å
- `WeatherServer.kt` ‚Äî MCP —Å–µ—Ä–≤–µ—Ä (JSON-RPC over stdio)
- `WeatherApiClient.kt` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è WeatherAPI
- `WeatherApiModels.kt` ‚Äî –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–≥–æ–¥—ã

## MCP Integration

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Model Context Protocol –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π AI:
- MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ subprocess –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ stdin/stdout (StdioTransport)
- –ü—Ä–æ—Ç–æ–∫–æ–ª: JSON-RPC 2.0
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** —Å–º. [WEATHER_MCP_README.md](WEATHER_MCP_README.md)

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (stderr)
```
[Ollama API] REQUEST [2025-12-17 00:45:23.456]
  ‚Üí POST http://localhost:11434/api/chat
  ‚Üí –° –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (tool calling enabled)
  
[Tool Call] [2025-12-17 00:45:24.234]
  üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: get_current_weather
  ‚úì –†–µ–∑—É–ª—å—Ç–∞—Ç: {"location":{"name":"Moscow",...}}
```

### –§–∞–π–ª –ª–æ–≥–æ–≤

**Ollama API** ‚Üí `ollama_api.log`:
- –ü–æ–ª–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ HTTP
- –í—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –û—à–∏–±–∫–∏ –∏ —Å—Ç–µ–∫-—Ç—Ä–µ–π—Å—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–π

**Weather API** ‚Üí `weather_api.log`:
- –ó–∞–ø—Ä–æ—Å—ã –∫ weatherapi.com
- –û—Ç–≤–µ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–≥–æ–¥—ã
- –û—à–∏–±–∫–∏ API –ø–æ–≥–æ–¥—ã

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `/stats` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** —Å–º. [LOGGING.md](LOGGING.md)
