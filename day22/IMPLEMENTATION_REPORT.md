# –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è: –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìã –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏-—Å–µ—Ä–≤–∏—Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å:
- RAG –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ FAQ
- MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM (—á–µ—Ä–µ–∑ JSON —Ñ–∞–π–ª)
- –£—á–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** "–ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è?" ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç, —É—á–∏—Ç—ã–≤–∞—è –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–∏–∫–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### 1. –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ß—Ç–æ –±—ã–ª–æ:**
- RAG —Å–∏—Å—Ç–µ–º–∞ —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å chunking
- LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Ollama
- CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∫–æ–º–∞–Ω–¥—ã: index, search, qa, history, stats, clear, remove)
- SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- 9 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ –ø—Ä–æ–µ–∫—Ç–µ –°–æ–Ω–∞—Ç–∞-2041

**–ß—Ç–æ –Ω—É–∂–Ω–æ –±—ã–ª–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CRM –¥–∞–Ω–Ω—ã–º–∏
- JSON —Ñ–∞–π–ª —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ç–∏–∫–µ—Ç–∞–º–∏
- FAQ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MCP –≤ RAG —Å–∏—Å—Ç–µ–º—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLI –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å user-id

---

### 2. –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 2.1. –î–∞–Ω–Ω—ã–µ CRM (JSON)

**–§–∞–π–ª:** `data/crm_data.json`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "users": [
    {
      "id": "user_001",
      "name": "–ù–æ—Ä–∞ –í–µ–¥–µ–Ω–µ–µ–≤–∞",
      "email": "n.vedeneeva@sevkvarts.ru",
      "role": "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞",
      "organization": "–ê–û –°–µ–≤–ö–≤–∞—Ä—Ü",
      "subscription": "enterprise"
    },
    // ... 5 –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  ],
  "tickets": [
    {
      "id": "ticket_001",
      "user_id": "user_003",
      "title": "–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ –°–æ–Ω–∞—Ç–∞",
      "description": "...",
      "status": "open",
      "priority": "high",
      "category": "authentication",
      "tags": ["–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è", "–¥–æ—Å—Ç—É–ø"]
    },
    // ... 9 –¥—Ä—É–≥–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤
  ]
}
```

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- 6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ (—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å, –∏–Ω–∂–µ–Ω–µ—Ä, –∞—Ä—Ö–∏–≤–∏—Å—Ç, —é—Ä–∏—Å—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, –∫–ª–∞–¥–æ–≤—â–∏–∫)
- 10 —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
  - 5 –æ—Ç–∫—Ä—ã—Ç—ã—Ö/–≤ —Ä–∞–±–æ—Ç–µ
  - 5 —Ä–µ—à–µ–Ω–Ω—ã—Ö
  - –†–∞–∑–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: critical (1), high (2), medium (4), low (3)
  - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: authentication, search, indexing, configuration, infrastructure, etc.

---

#### 2.2. FAQ –¥–æ–∫—É–º–µ–Ω—Ç—ã

–°–æ–∑–¥–∞–Ω—ã 5 –ø–æ–¥—Ä–æ–±–Ω—ã—Ö FAQ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:

1. **FAQ_01_–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è_–∏_–¥–æ—Å—Ç—É–ø.txt** (~3 KB)
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞
   - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
   - –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
   - –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏

2. **FAQ_02_–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è_–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.txt** (~8 KB)
   - –ö–∞–∫ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
   - –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
   - Chunk-size –∏ overlap
   - –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –û—à–∏–±–∫–∏ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

3. **FAQ_03_–ü–æ–∏—Å–∫_–∏_RAG.txt** (~9 KB)
   - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
   - –ß—Ç–æ —Ç–∞–∫–æ–µ RAG
   - –†–µ—Ä–∞–Ω–∫–∏–Ω–≥ –∏ –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
   - Relevance threshold
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–∏—Å–∫–æ–º
   - "–ö–≤–∞—Ä—Ü–µ–≤—ã–π —à—ë–ø–æ—Ç"
   - –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
   - –†–∞–∑–ª–∏—á–∏—è plain vs rag —Ä–µ–∂–∏–º–æ–≤

4. **FAQ_04_–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è_–∏_–Ω–∞—Å—Ç—Ä–æ–π–∫–∞.txt** (~9 KB)
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ollama
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ LLM
   - –õ–æ–≥–∏
   - –†–µ–≥–ª–∞–º–µ–Ω—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è
   - Docker

5. **FAQ_05_–ü–æ–¥–¥–µ—Ä–∂–∫–∞_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.txt** (~10 KB)
   - –ö–∞–∫ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ç–∏–∫–µ—Ç—ã
   - –°—Ç–∞—Ç—É—Å—ã —Ç–∏–∫–µ—Ç–æ–≤
   - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ó–∞–ø—Ä–æ—Å –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - –û–±—É—á–µ–Ω–∏–µ
   - –°–æ–æ–±—â–µ—Å—Ç–≤–æ
   - –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

**–û–±—â–∏–π –æ–±—ä–µ–º FAQ:** ~39 KB, ~100+ –≤–æ–ø—Ä–æ—Å–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤

---

#### 2.3. MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä

**–§–∞–π–ª—ã:**
- `src/main/kotlin/mcp/McpModels.kt` - –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- `src/main/kotlin/mcp/McpService.kt` - —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CRM

**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
```kotlin
@Serializable
data class User(
    val id: String,
    val name: String,
    val email: String,
    val role: String,
    val organization: String,
    val subscription: String,
    val registeredAt: String
)

@Serializable
data class Ticket(
    val id: String,
    val userId: String,
    val title: String,
    val description: String,
    val status: String,
    val priority: String,
    val category: String,
    val createdAt: String,
    val updatedAt: String,
    val resolvedAt: String? = null,
    val resolution: String? = null,
    val assignedTo: String? = null,
    val tags: List<String> = emptyList()
)

data class UserContext(
    val user: User,
    val activeTickets: List<Ticket>,
    val recentTickets: List<Ticket>
)
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å McpService:**
- `getUserById(userId)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
- `getUserByEmail(email)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
- `getUserTickets(userId)` - –≤—Å–µ —Ç–∏–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `getActiveTickets(userId)` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã (open, in_progress)
- `getRecentResolvedTickets(userId)` - –Ω–µ–¥–∞–≤–Ω–∏–µ —Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã
- `getUserContext(userId)` - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è RAG
- `searchSimilarTickets(query)` - –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤
- `getUserTicketStats(userId)` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 1 –º–∏–Ω—É—Ç—É

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**
```kotlin
fun UserContext.toContextString(): String = """
=== –ö–û–ù–¢–ï–ö–°–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
  –ò–º—è: ${user.name}
  –†–æ–ª—å: ${user.role}
  ...

–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã:
  –¢–∏–∫–µ—Ç #${ticket.id}
    –ù–∞–∑–≤–∞–Ω–∏–µ: ${ticket.title}
    –û–ø–∏—Å–∞–Ω–∏–µ: ${ticket.description}
    ...

=== –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ===
"""
```

---

#### 2.4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MCP –≤ RAG —Å–∏—Å—Ç–µ–º—É

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/main/kotlin/search/RagService.kt`:**

1. **–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä userContext:**
```kotlin
interface RagService {
    suspend fun answerWithRag(
        question: String,
        topK: Int = 5,
        enableReranking: Boolean = false,
        relevanceThreshold: Float? = null,
        rerankTopK: Int? = null,
        userContext: UserContext? = null  // üÜï
    ): RagAnswer
    
    suspend fun answerWithoutRag(
        question: String,
        userContext: UserContext? = null  // üÜï
    ): String
}
```

2. **–û–±–Ω–æ–≤–ª–µ–Ω System Prompt:**
```kotlin
val systemPrompt = if (userContext != null) {
    """
    –¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –°–æ–Ω–∞—Ç–∞-2041.
    
    –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ FAQ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤.
    –£—á–∏—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã, –∏—Å—Ç–æ—Ä–∏—é).
    
    –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã –ø–æ –ø–æ—Ö–æ–∂–µ–π –ø—Ä–æ–±–ª–µ–º–µ,
    –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω–∏ –∏—Ö.
    
    –ï—Å–ª–∏ –ø–æ—Ö–æ–∂–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —É–∂–µ —Ä–µ—à–∞–ª–∞—Å—å —Ä–∞–Ω–µ–µ, –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ
    —Ä–µ—à–µ–Ω–∏–µ –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –æ—Ç–≤–µ—Ç–∞.
    """
} else {
    // –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
}
```

3. **–î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ User Message:**
```kotlin
val userMessage = buildString {
    if (userContext != null) {
        appendLine(userContext.toContextString())
        appendLine()
    }
    
    appendLine("–í–æ–ø—Ä–æ—Å:")
    appendLine(question)
    appendLine()
    appendLine("–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ FAQ:")
    appendLine(contextText)
}
```

---

#### 2.5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLI

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/main/kotlin/cli/CommandParser.kt`:**

1. **–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```kotlin
private val userId by option(
    "--user-id",
    help = "User ID from CRM system to provide personalized context"
)

private val crmDataPath by option(
    "--crm-data",
    help = "Path to CRM data JSON file"
).default("data/crm_data.json")
```

2. **–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**
```kotlin
// –°–æ–∑–¥–∞–µ–º MCP —Å–µ—Ä–≤–∏—Å
val mcpService = McpService(crmDataPath)

// –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω user-id
val userContext = userId?.let { id ->
    try {
        val context = mcpService.getUserContext(id)
        if (context == null) {
            println("‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$id' –Ω–µ –Ω–∞–π–¥–µ–Ω")
        }
        context
    } catch (e: Exception) {
        println("‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ CRM: ${e.message}")
        null
    }
}
```

3. **–í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:**
```kotlin
if (userContext != null) {
    println("üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userContext.user.name}")
    println("üìß Email: ${userContext.user.email}")
    if (userContext.activeTickets.isNotEmpty()) {
        println("üé´ –ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤: ${userContext.activeTickets.size}")
    }
    println()
}
```

4. **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ RAG:**
```kotlin
val ragAnswer = ragService.answerWithRag(
    question = question,
    topK = topK,
    enableReranking = enableReranking,
    relevanceThreshold = relevanceThreshold,
    rerankTopK = if (enableReranking) rerankTopKValue else null,
    userContext = userContext  // üÜï
)
```

---

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω—ã —Ç—Ä–∏ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞:

#### 3.1. SETUP_AND_USAGE.md (~15 KB)
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö CRM
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤
- –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 3.2. DEMO_EXAMPLES.md (~18 KB)
- 6 –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–±—ä—è—Å–Ω–µ–Ω–∏—è "—á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º"
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º vs –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 3.3. README.md (–æ–±–Ω–æ–≤–ª–µ–Ω)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º --user-id –∏ --crm-data
- –†–∞–∑–¥–µ–ª "–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è"
- –°—Å—ã–ª–∫–∏ –Ω–∞ SETUP_AND_USAGE.md –∏ DEMO_EXAMPLES.md

---

## üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ RAG —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- 9 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ –ø—Ä–æ–µ–∫—Ç–µ –°–æ–Ω–∞—Ç–∞-2041
- 5 –ø–æ–¥—Ä–æ–±–Ω—ã—Ö FAQ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (~39 KB)
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥–æ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤

### ‚úÖ MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- JSON —Ñ–∞–π–ª —Å 6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- 10 —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (—Ä–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ user-id
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤

### ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –£—á–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- 6 –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π README —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

---

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CLI (QaCommand)                        ‚îÇ
‚îÇ  ./gradlew run --args='qa --mode rag --user-id X ...'  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                                 ‚îÇ
            ‚ñº                                 ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  MCP Service  ‚îÇ              ‚îÇ   RAG Pipeline   ‚îÇ
    ‚îÇ               ‚îÇ              ‚îÇ                  ‚îÇ
    ‚îÇ ‚Ä¢ getUserCtx  ‚îÇ              ‚îÇ ‚Ä¢ Search         ‚îÇ
    ‚îÇ ‚Ä¢ getTickets  ‚îÇ              ‚îÇ ‚Ä¢ Rerank         ‚îÇ
    ‚îÇ ‚Ä¢ format      ‚îÇ              ‚îÇ ‚Ä¢ Filter         ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                               ‚îÇ
            ‚ñº                               ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ crm_data.json  ‚îÇ            ‚îÇ  SQLite Index   ‚îÇ
    ‚îÇ                ‚îÇ            ‚îÇ                 ‚îÇ
    ‚îÇ ‚Ä¢ users        ‚îÇ            ‚îÇ ‚Ä¢ documents     ‚îÇ
    ‚îÇ ‚Ä¢ tickets      ‚îÇ            ‚îÇ ‚Ä¢ chunks        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ ‚Ä¢ embeddings    ‚îÇ
                                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                            ‚îÇ
                                            ‚ñº
                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                  ‚îÇ   LLM (Ollama)   ‚îÇ
                                  ‚îÇ                  ‚îÇ
                                  ‚îÇ ‚Ä¢ nomic-embed    ‚îÇ
                                  ‚îÇ ‚Ä¢ llama3.1:8b    ‚îÇ
                                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ö–æ–¥
- –ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤: 7
  - 2 MCP (McpModels.kt, McpService.kt)
  - 5 FAQ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - 1 CRM –¥–∞–Ω–Ω—ã–µ (JSON)
  - 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (MD)
- –ò–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤: 2
  - RagService.kt (–¥–æ–±–∞–≤–ª–µ–Ω userContext)
  - CommandParser.kt (–¥–æ–±–∞–≤–ª–µ–Ω --user-id)

### –î–∞–Ω–Ω—ã–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 6
- –¢–∏–∫–µ—Ç–æ–≤: 10
- FAQ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: 5 (~39 KB)
- –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞: 9
- **–ò—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è RAG: 14**

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- SETUP_AND_USAGE.md: ~15 KB
- DEMO_EXAMPLES.md: ~18 KB
- README.md: –æ–±–Ω–æ–≤–ª–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω–æ ~3 KB
- **–ò—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: ~36 KB**

---

## üé≠ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å —Å RAG
```bash
./gradlew run --args='qa --mode rag –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–µ–∫—Ç –°–æ–Ω–∞—Ç–∞-2041?'
```
–û—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.

### –ü—Ä–∏–º–µ—Ä 2: –í–æ–ø—Ä–æ—Å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
./gradlew run --args='qa --mode rag --user-id user_003 –ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è?'
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. MCP –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç user_003 (–ò–ª—å—è –ì—Ä–æ–º–∏–Ω, –∏–Ω–∂–µ–Ω–µ—Ä)
2. –í–∏–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∏–∫–µ—Ç #ticket_001 "–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
3. –ù–∞—Ö–æ–¥–∏—Ç FAQ –ø—Ä–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
4. –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç: "–ò–ª—å—è, –≤–∏–∂—É –≤–∞—à —Ç–∏–∫–µ—Ç #ticket_001..."

### –ü—Ä–∏–º–µ—Ä 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ—à–µ–Ω–∏–π
```bash
./gradlew run --args='qa --mode rag --user-id user_005 –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Ollama'
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. MCP –≤–∏–¥–∏—Ç —Ä–µ—à–µ–Ω–Ω—ã–π —Ç–∏–∫–µ—Ç #ticket_009 —Å —Ç–∞–∫–æ–π –∂–µ –ø—Ä–æ–±–ª–µ–º–æ–π
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ—à–µ–Ω–∏–µ: "–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ"
3. –î–æ–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏–∑ FAQ
4. –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ–ø—ã—Ç–∞

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ollama
curl -fsSL https://ollama.com/install.sh | sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Ollama
ollama serve

# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–æ–¥–µ–ª–∏
ollama pull nomic-embed-text:latest
ollama pull llama3.1:8b
```

### 2. –°–±–æ—Ä–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
```bash
cd /home/vas/Documents/Projects/AIAdventChallenge5/day22

# –°–±–æ—Ä–∫–∞
./gradlew build

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è
./gradlew run --args="clear"
./gradlew run --args="index data"

# –ü—Ä–æ–≤–µ—Ä–∫–∞
./gradlew run --args="stats"
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ë–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
./gradlew run --args='qa --mode rag –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫?'

# –° –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
./gradlew run --args='qa --mode rag --user-id user_003 –ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è?'

# –° –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
./gradlew run --args='qa --mode rag --user-id user_002 --enable-reranking --relevance-threshold 0.5 –ü–æ—á–µ–º—É –ø–æ–∏—Å–∫ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã?'
```

---

## üéì –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **–Ø–∑—ã–∫:** Kotlin 2.2.20
- **JVM:** Java 21
- **Database:** SQLite (Exposed ORM)
- **HTTP:** Ktor Client
- **CLI:** Clikt
- **Serialization:** kotlinx.serialization
- **LLM:** Ollama (llama3.1:8b)
- **Embeddings:** nomic-embed-text

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **MCP –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å:**
   - –õ–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é CRM API
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

2. **–ù–µ–∏–Ω–≤–∞–∑–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - RagService –ø–æ–ª—É—á–∏–ª –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä userContext
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
   - CLI –¥–æ–±–∞–≤–ª–µ–Ω –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π --user-id

3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:**
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Ç–∏–∫–µ—Ç—ã –≤ JSON
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ FAQ –¥–æ–∫—É–º–µ–Ω—Ç—ã
   - McpService –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –£–º–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```kotlin
data class UserContext {
    fun toContextString(): String = buildString {
        appendLine("=== –ö–û–ù–¢–ï–ö–°–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===")
        // ... —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
        appendLine("=== –ö–û–ù–ï–¶ –ö–û–ù–¢–ï–ö–°–¢–ê ===")
    }
}
```

### 2. Graceful degradation
```kotlin
val userContext = userId?.let { id ->
    try {
        mcpService.getUserContext(id)
    } catch (e: Exception) {
        println("‚ö†Ô∏è  –û—à–∏–±–∫–∞: ${e.message}")
        println("   –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞")
        null
    }
}
```

### 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –≤—ã–≤–æ–¥
```kotlin
if (userContext != null) {
    println("üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userContext.user.name}")
    println("üìß Email: ${userContext.user.email}")
    println("üé´ –ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤: ${userContext.activeTickets.size}")
}
```

### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ CRM –¥–∞–Ω–Ω—ã—Ö
```kotlin
private var crmData: CrmData? = null
private var lastLoadTime: Long = 0
private val cacheTimeout = 60_000L // 1 –º–∏–Ω—É—Ç–∞

if (crmData != null && (currentTime - lastLoadTime) < cacheTimeout) {
    return crmData!!  // –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à
}
```

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ RAG –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏/FAQ
- ‚úÖ MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM (—á–µ—Ä–µ–∑ JSON)
- ‚úÖ –£—á–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: "–ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è?" —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ 5 –ø–æ–¥—Ä–æ–±–Ω—ã—Ö FAQ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ 10 —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
- ‚úÖ 6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º
- ‚úÖ –û–±—à–∏—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (50+ KB)
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üîÆ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ–π CRM API (–≤–º–µ—Å—Ç–æ JSON)
2. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –∏–∑ –≤–æ–ø—Ä–æ—Å–æ–≤
4. –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ
1. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
2. Webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º
4. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ
1. –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. –ì–æ–ª–æ—Å–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**, –∫–æ—Ç–æ—Ä—ã–π:

1. **–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã** –∏—Å–ø–æ–ª—å–∑—É—è RAG —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∏ FAQ
2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å CRM** —á–µ—Ä–µ–∑ MCP –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ç–∏–∫–µ—Ç–∞–º–∏
3. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã** —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç–∏–∫–µ—Ç—ã
5. **–•–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** - 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ RAG –∏ MCP –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

---

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2026-01-14  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0
