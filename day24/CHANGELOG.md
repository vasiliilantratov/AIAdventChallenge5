# Changelog - Новая функциональность

## Дата: 2026-01-17

### Обновление: v1.1.0 (умное определение намерений)

**Изменено:**
- Метод `detectReleaseIntent` теперь использует LLM для анализа намерений вместо простой проверки по ключевым словам
- LLM теперь понимает не только прямые команды ("зарелизь"), но и естественные формулировки ("пора делать релиз", "можешь зарелизить?")
- LLM умеет отличать команды от вопросов (не сработает на "что такое релиз?")

**Преимущества:**
- Более гибкое понимание пользовательских запросов
- Поддержка естественного языка
- Контекстное понимание намерений
- Меньше ложных срабатываний

### Дата: 2026-01-17 (первоначальная версия)

### Добавлено

#### 1. Интерактивная команда `chat`

**Файл:** `src/main/kotlin/cli/ChatCommand.kt`

Новая команда для интерактивного общения с LLM с поддержкой специальных команд:

- **Интерактивный режим**: Непрерывное общение с LLM
- **История диалога**: Автоматическое сохранение всех сообщений в БД
- **Специальные команды**:
  - `/exit`, `/quit` - выход из чата
  - `/clear` - начать новую беседу
  - `/history` - показать историю текущей беседы
- **Умное определение намерений**: Автоматическое распознавание команд релиза

**Использование:**
```bash
./gradlew run --args='chat'
./gradlew run --args='chat Привет! Расскажи о себе'
```

#### 2. MCP для релиза приложения

**Файл:** `src/main/kotlin/mcp/ReleaseMcp.kt`

Новый MCP-клиент для автоматизации релиза приложений через SSH:

**Основные функции:**
- `testConnection()` - проверка SSH соединения
- `checkLocalDirectory()` - проверка локальной директории
- `getLocalFiles()` - получение списка файлов
- `createRemoteDirectory()` - создание удаленной директории
- `release()` - выполнение полного релиза через rsync
- `getRemoteInfo()` - информация о файлах на сервере
- `cleanRemoteDirectory()` - очистка удаленной директории

**Конфигурация:**
- SSH конфигурация: `my_mon_bot`
- Локальная директория: `/home/vas/Documents/Projects/EchoBot`
- Удаленная директория: `/root/release`

**Интеграция с chat:**
При обнаружении ключевых слов в сообщении (`зарелизь`, `сделай релиз`, `deploy` и т.д.) автоматически запускается процесс релиза с подробным выводом статистики.

**Использование в chat:**
```bash
./gradlew run --args='chat зарелизь приложение'
```

#### 3. Обновления в Main.kt

**Файл:** `src/main/kotlin/Main.kt`

Добавлена регистрация команды `ChatCommand()` в список доступных команд.

### Документация

#### Создано:

1. **RELEASE_MCP.md** - Подробная документация по MCP для релиза:
   - Описание архитектуры
   - API документация всех методов
   - Настройка SSH
   - Безопасность
   - Примеры использования
   - Troubleshooting
   - FAQ

2. **EXAMPLES.md** - Практические примеры использования:
   - Базовый интерактивный чат
   - Релиз через chat
   - Работа с историей
   - Обработка ошибок
   - Программное использование MCP
   - Автоматизация через скрипты
   - CI/CD интеграция

3. **test-new-features.sh** - Скрипт для проверки работоспособности:
   - Проверка сборки проекта
   - Проверка регистрации команды chat
   - Проверка SSH конфигурации
   - Проверка локальной директории
   - Проверка rsync
   - Проверка Ollama
   - Вывод доступных команд

#### Обновлено:

1. **README.md** - Добавлены разделы:
   - Интерактивный чат с LLM (/chat)
   - MCP для релиза приложения
   - Обновлена секция "Примеры"
   - Обновлена секция "Архитектура"

### Технические детали

#### Зависимости
Нет новых зависимостей. Используются существующие:
- Kotlin Coroutines
- Ktor Client
- SQLite (через Exposed)
- Clikt (CLI framework)

#### Требования
- Java 21+
- Gradle
- Ollama с моделью `llama3.1:8b`
- rsync (для релиза)
- Настроенный SSH конфиг (для релиза)

### Безопасность

#### ReleaseMcp
- Проверка путей для предотвращения выхода за пределы разрешенных директорий
- Использование SSH-ключей для аутентификации
- Логирование всех операций релиза

#### ChatCommand
- Сохранение истории в локальной БД
- Проверка доступности SSH перед выполнением релиза
- Детальный вывод ошибок для отладки

### Совместимость

Все изменения обратно совместимы. Существующие команды продолжают работать без изменений:
- `index` - индексация документов
- `search` - поиск
- `qa` - вопросы к LLM
- `history` - история диалогов
- `help` - ассистент разработчика
- `team` - командный ассистент
- `stats` - статистика
- `clear` - очистка индекса
- `remove` - удаление документа

### Тестирование

#### Автоматическая проверка
Запустить: `./test-new-features.sh`

Проверяет:
1. ✅ Сборка проекта
2. ✅ Регистрация команды chat
3. ✅ SSH соединение
4. ✅ Локальная директория для релиза
5. ✅ Установка rsync
6. ✅ Доступность Ollama

#### Ручное тестирование

1. **Базовый чат:**
   ```bash
   ./gradlew run --args='chat Привет!'
   ```

2. **Релиз (если настроен SSH):**
   ```bash
   ./gradlew run --args='chat зарелизь приложение'
   ```

3. **Интерактивный режим:**
   ```bash
   ./gradlew run --args='chat'
   # Попробуйте команды: /history, /clear, /exit
   ```

### Известные ограничения

1. **Релиз работает только через SSH** - другие протоколы не поддерживаются
2. **Rsync должен быть установлен** на обеих машинах
3. **SSH конфиг должен быть настроен** для беспарольного входа
4. **Локальная директория жестко задана** в коде (можно изменить в ReleaseMcp.kt)

### Roadmap

Планируется:
- [ ] Поддержка множественных серверов для релиза
- [ ] Автоматические резервные копии перед релизом
- [ ] Rollback функциональность
- [ ] Webhook уведомления о статусе релиза
- [ ] Поддержка Docker контейнеров
- [ ] Интеграция с CI/CD системами

### Контакты и поддержка

Для вопросов и предложений:
- Создайте issue в репозитории
- Изучите документацию: README.md, RELEASE_MCP.md, EXAMPLES.md
- Запустите тестовый скрипт: ./test-new-features.sh

---

**Версия:** 1.0.0  
**Дата релиза:** 2026-01-17  
**Автор:** AI Assistant
