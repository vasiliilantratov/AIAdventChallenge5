#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
# Usage: ./test-new-features.sh

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë     –¢–µ—Å—Ç –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏: Chat + Release MCP         ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç—É—Å–∞
print_status() {
    if [ $1 -eq 0 ]; then
        echo -e "${GREEN}‚úÖ $2${NC}"
    else
        echo -e "${RED}‚ùå $2${NC}"
    fi
}

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞..."
./gradlew build > /dev/null 2>&1
print_status $? "–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞"
echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã chat --help
echo "2Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã 'chat --help'..."
OUTPUT=$(./gradlew run --args='chat --help' 2>&1)
if echo "$OUTPUT" | grep -q "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç —Å LLM"; then
    print_status 0 "–ö–æ–º–∞–Ω–¥–∞ chat –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞"
else
    print_status 1 "–ö–æ–º–∞–Ω–¥–∞ chat –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if ssh -o ConnectTimeout=5 my_mon_bot "echo OK" > /dev/null 2>&1; then
    print_status 0 "SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å my_mon_bot —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo -e "${YELLOW}‚ö†Ô∏è  SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ${NC}"
    echo "   –î–ª—è —Ä–∞–±–æ—Ç—ã —Ä–µ–ª–∏–∑–∞ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥:"
    echo "   ~/.ssh/config –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:"
    echo ""
    echo "   Host my_mon_bot"
    echo "       HostName your-server.com"
    echo "       User root"
    echo "       IdentityFile ~/.ssh/id_rsa"
    echo ""
fi
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–ª–∏–∑–∞
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–ª–∏–∑–∞..."
if [ -d "/home/vas/Documents/Projects/EchoBot" ]; then
    FILE_COUNT=$(find /home/vas/Documents/Projects/EchoBot -type f | wc -l)
    print_status 0 "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /home/vas/Documents/Projects/EchoBot –Ω–∞–π–¥–µ–Ω–∞ ($FILE_COUNT —Ñ–∞–π–ª–æ–≤)"
else
    echo -e "${YELLOW}‚ö†Ô∏è  –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /home/vas/Documents/Projects/EchoBot –Ω–µ –Ω–∞–π–¥–µ–Ω–∞${NC}"
    echo "   –î–ª—è —Ä–∞–±–æ—Ç—ã —Ä–µ–ª–∏–∑–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å —Ñ–∞–π–ª–∞–º–∏"
    echo "   –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å –≤ ReleaseMcp.kt"
fi
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ rsync
echo "5Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ rsync..."
if command -v rsync &> /dev/null; then
    RSYNC_VERSION=$(rsync --version | head -n1)
    print_status 0 "rsync —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $RSYNC_VERSION"
else
    echo -e "${YELLOW}‚ö†Ô∏è  rsync –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
    echo "   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: sudo apt-get install rsync"
fi
echo ""

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ Ollama
echo "6Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ Ollama..."
if curl -s http://localhost:11434/api/tags > /dev/null 2>&1; then
    print_status 0 "Ollama —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo -e "${YELLOW}‚ö†Ô∏è  Ollama —Å–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω${NC}"
    echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ollama serve"
fi
echo ""

# 7. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "1. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è):"
echo "   ./gradlew run --args='chat'"
echo ""
echo "2. –ß–∞—Ç —Å –Ω–∞—á–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:"
echo "   ./gradlew run --args='chat –ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ'"
echo ""
echo "3. –¢–µ—Å—Ç —Ä–µ–ª–∏–∑–∞ (–µ—Å–ª–∏ SSH –Ω–∞—Å—Ç—Ä–æ–µ–Ω):"
echo "   ./gradlew run --args='chat –∑–∞—Ä–µ–ª–∏–∑—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'"
echo ""
echo "4. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥:"
echo "   ./gradlew run --args='--help'"
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
echo "üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:"
echo ""
if [ -d "/home/vas/Documents/Projects/EchoBot" ] && ssh -o ConnectTimeout=5 my_mon_bot "echo OK" > /dev/null 2>&1; then
    echo -e "${GREEN}‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!${NC}"
    echo "   –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —Ä–µ–ª–∏–∑–∞ –≤ —á–∞—Ç–µ."
else
    echo -e "${YELLOW}‚ö†Ô∏è  –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—á–Ω–æ –≥–æ—Ç–æ–≤–∞${NC}"
    echo "   –ö–æ–º–∞–Ω–¥–∞ chat —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –¥–ª—è —Ä–µ–ª–∏–∑–∞ –Ω—É–∂–Ω–æ:"
    if [ ! -d "/home/vas/Documents/Projects/EchoBot" ]; then
        echo "   - –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é /home/vas/Documents/Projects/EchoBot"
    fi
    if ! ssh -o ConnectTimeout=5 my_mon_bot "echo OK" > /dev/null 2>&1; then
        echo "   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (—Å–º. RELEASE_MCP.md)"
    fi
fi
echo ""
echo "–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–º. —Ñ–∞–π–ª—ã:"
echo "  - README.md (–æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)"
echo "  - RELEASE_MCP.md (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ–ª–∏–∑—É)"
echo ""
